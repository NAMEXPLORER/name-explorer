<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Colorful Name Explorer ‚Äî Global Name Analysis</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
<script src="https://unpkg.com/globe.gl"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
--primary: #8B5FBF;
--secondary: #FF6B6B;
--accent: #4ECDC4;
--highlight: #FFD166;
--dark: #2D3047;
--light: #F7F9FC;
}

body {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
color: #333;
}

.glass-card {
background: rgba(255, 255, 255, 0.85);
backdrop-filter: blur(10px);
border-radius: 20px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
border: 1px solid rgba(255, 255, 255, 0.3);
}

.gradient-bg {
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
}

.gradient-text {
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.btn-primary {
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
transition: all 0.3s ease;
border: none;
color: white;
font-weight: 600;
}

.btn-primary:hover:not(:disabled) {
transform: translateY(-3px);
box-shadow: 0 10px 20px rgba(139, 95, 191, 0.3);
}

.btn-secondary {
background: linear-gradient(135deg, var(--accent) 0%, var(--highlight) 100%);
transition: all 0.3s ease;
border: none;
color: var(--dark);
font-weight: 600;
}

.btn-secondary:hover {
transform: translateY(-3px);
box-shadow: 0 10px 20px rgba(78, 205, 196, 0.3);
}

.chip {
display: inline-flex;
align-items: center;
padding: 0.5rem 1rem;
border-radius: 50px;
margin: 0.25rem;
font-size: 0.875rem;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 500;
border: 2px solid transparent;
}

.chip:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.seed-chip {
background: linear-gradient(135deg, rgba(139, 95, 191, 0.2) 0%, rgba(255, 107, 107, 0.2) 100%);
color: var(--primary);
border-color: rgba(139, 95, 191, 0.3);
}

.dynamic-chip {
background: linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(255, 209, 102, 0.2) 100%);
color: var(--accent);
border-color: rgba(78, 205, 196, 0.3);
}

.fade-in {
animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

.pulse {
animation: pulse 2s infinite;
}

@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}

.globe-container {
width: 100%;
height: 500px;
border-radius: 20px;
overflow: hidden;
background: rgba(0, 0, 0, 0.1);
}

.tab-active {
background: rgba(255, 255, 255, 0.3);
color: white;
font-weight: 600;
}

.section-title {
position: relative;
display: inline-block;
margin-bottom: 1.5rem;
}

.section-title::after {
content: '';
position: absolute;
bottom: -8px;
left: 0;
width: 50%;
height: 3px;
background: linear-gradient(90deg, var(--primary), transparent);
border-radius: 3px;
}

.loading-spinner {
display: inline-block;
width: 24px;
height: 24px;
border: 3px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
margin-right: 0.5rem;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

.country-flag {
width: 40px;
height: 30px;
object-fit: cover;
border-radius: 4px;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.feature-badge {
display: inline-flex;
align-items: center;
padding: 0.5rem 1rem;
background: rgba(255, 255, 255, 0.2);
color: white;
border-radius: 50px;
font-size: 0.875rem;
font-weight: 600;
margin: 0 0.25rem 0.5rem 0;
backdrop-filter: blur(5px);
}

.color-card-1 {
background: linear-gradient(135deg, #FF9A8B 0%, #FF6A88 55%, #FF99AC 100%);
}

.color-card-2 {
background: linear-gradient(135deg, #6A11CB 0%, #2575FC 100%);
}

.color-card-3 {
background: linear-gradient(135deg, #42E695 0%, #3BB2B8 100%);
}

.color-card-4 {
background: linear-gradient(135deg, #FFD26F 0%, #FFA36C 100%);
}

.glow {
box-shadow: 0 0 20px rgba(139, 95, 191, 0.3);
}
</style>
</head>
<body class="text-gray-800">
<!-- Header -->
<header class="py-6 px-4">
<div class="max-w-7xl mx-auto">
<div class="flex items-center justify-between">
<div class="flex items-center space-x-3">
<div class="w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-lg glow">
<i class="fas fa-globe-americas text-2xl gradient-text"></i>
</div>
<h1 class="text-3xl font-bold text-white">NameExplorer</h1>
</div>
<div class="flex space-x-4">
<button class="px-4 py-2 rounded-full text-sm text-white bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors">
<i class="fas fa-info-circle mr-2"></i>About
</button>
<button class="px-4 py-2 rounded-full text-sm text-white bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors">
<i class="fas fa-shield-alt mr-2"></i>Privacy
</button>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main class="py-8 px-4">
<div class="max-w-7xl mx-auto">
<!-- Hero Section -->
<div class="text-center mb-12">
<h2 class="text-5xl font-bold text-white mb-4">Discover Your Name's <span class="gradient-text">Colorful Journey</span></h2>
<p class="text-xl text-white/90 max-w-2xl mx-auto">
Explore the vibrant cultural origins and global distribution of names with our privacy-first analysis tool.
</p>
<div class="flex flex-wrap justify-center mt-6">
<span class="feature-badge"><i class="fas fa-palette mr-2"></i> Colorful Visualizations</span>
<span class="feature-badge"><i class="fas fa-globe-americas mr-2"></i> Interactive Globe</span>
<span class="feature-badge"><i class="fas fa-music mr-2"></i> Multi-language TTS</span>
<span class="feature-badge"><i class="fas fa-user-shield mr-2"></i> 100% Private</span>
</div>
</div>

<!-- Main Dashboard -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
<!-- Left Panel - Input & Basic Info -->
<div class="lg:col-span-1">
<div class="glass-card p-6 h-full">
<!-- Privacy Consent -->
<div class="mb-6">
<div class="flex items-start mb-4">
<input
type="checkbox"
id="consentCheckbox"
class="mr-3 mt-1 h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500"
>
<label for="consentCheckbox" class="text-gray-700 text-sm">
I understand this tool processes names entirely in my browser. No data is stored or transmitted.
</label>
</div>
</div>

<!-- Search Section -->
<div class="mb-6">
<div class="relative">
<input
id="nameInput"
type="text"
placeholder="Enter a name to explore..."
class="w-full p-4 pl-12 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-lg bg-white/80"
maxlength="50"
>
<div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
<i class="fas fa-search"></i>
</div>
</div>
</div>

<!-- Action Button -->
<button
id="analyzeBtn"
class="btn-primary w-full py-4 rounded-xl text-lg font-semibold mb-6"
disabled
>
<span id="btnText">
<i class="fas fa-rocket mr-2"></i>Analyze Name
</span>
<span id="btnLoading" class="hidden">
<div class="loading-spinner"></div> Exploring...
</span>
</button>

<!-- Quick Stats -->
<div id="quickStats" class="hidden">
<div class="grid grid-cols-2 gap-4 mb-6">
<div class="color-card-1 p-4 rounded-xl text-center text-white">
<div class="text-2xl font-bold" id="topProbability">0%</div>
<div class="text-sm text-white/90">Top Probability</div>
</div>
<div class="color-card-2 p-4 rounded-xl text-center text-white">
<div class="text-2xl font-bold" id="countriesCount">0</div>
<div class="text-sm text-white/90">Countries</div>
</div>
</div>
</div>

<!-- Features List -->
<div class="space-y-3">
<div class="flex items-center text-gray-600">
<i class="fas fa-shield-alt text-purple-500 mr-3"></i>
<span>100% Private & Secure</span>
</div>
<div class="flex items-center text-gray-600">
<i class="fas fa-globe text-blue-500 mr-3"></i>
<span>Global Name Database</span>
</div>
<div class="flex items-center text-gray-600">
<i class="fas fa-volume-up text-green-500 mr-3"></i>
<span>Multi-language Pronunciation</span>
</div>
<div class="flex items-center text-gray-600">
<i class="fas fa-palette text-yellow-500 mr-3"></i>
<span>Colorful Visualizations</span>
</div>
</div>
</div>
</div>

<!-- Right Panel - Globe & Visualization -->
<div class="lg:col-span-2">
<div class="glass-card p-6 h-full">
<!-- Tabs -->
<div class="flex space-x-2 mb-6">
<button id="tabGlobe" class="tab-active px-4 py-2 rounded-lg transition-colors">
<i class="fas fa-globe mr-2"></i>Global Distribution
</button>
<button id="tabRegion" class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">
<i class="fas fa-map mr-2"></i>Regional Analysis
</button>
</div>

<!-- Globe Container -->
<div id="globeSection">
<div class="globe-container">
<div id="globeViz"></div>
</div>
<div class="text-center mt-4 text-gray-600">
<p>Click on highlighted regions to explore name distribution</p>
</div>
</div>

<!-- Region Details Container -->
<div id="regionSection" class="hidden">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- Country Details Card -->
<div class="color-card-3 p-6 rounded-2xl text-white">
<h3 class="text-xl font-bold mb-4 section-title">Top Country</h3>
<div id="countryDetails" class="text-center">
<div class="text-white/80">Analyze a name to see country details</div>
</div>
</div>

<!-- Regional Stats -->
<div class="color-card-4 p-6 rounded-2xl text-white">
<h3 class="text-xl font-bold mb-4 section-title">Regional Stats</h3>
<div id="regionalStats" class="space-y-4">
<div class="text-white/80">Regional data will appear here</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Results Section -->
<div id="results" class="glass-card p-6 mb-8"></div>

<!-- Features Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
<div class="color-card-1 p-6 rounded-2xl text-white text-center">
<div class="text-4xl mb-4"><i class="fas fa-database"></i></div>
<h3 class="text-xl font-bold mb-2">Global Database</h3>
<p class="text-white/80">Access comprehensive name data from cultures worldwide</p>
</div>
<div class="color-card-2 p-6 rounded-2xl text-white text-center">
<div class="text-4xl mb-4"><i class="fas fa-chart-pie"></i></div>
<h3 class="text-xl font-bold mb-2">Visual Analytics</h3>
<p class="text-white/80">Interactive visualizations of name distribution and origins</p>
</div>
<div class="color-card-3 p-6 rounded-2xl text-white text-center">
<div class="text-4xl mb-4"><i class="fas fa-user-shield"></i></div>
<h3 class="text-xl font-bold mb-2">Privacy First</h3>
<p class="text-white/80">Your data never leaves your device - guaranteed</p>
</div>
<div class="color-card-4 p-6 rounded-2xl text-white text-center">
<div class="text-4xl mb-4"><i class="fas fa-language"></i></div>
<h3 class="text-xl font-bold mb-2">Multi-language</h3>
<p class="text-white/80">Hear pronunciations in native accents and languages</p>
</div>
</div>
</div>
</main>

<!-- Footer -->
<footer class="py-8 px-4 text-white/80">
<div class="max-w-7xl mx-auto text-center">
<div class="flex justify-center space-x-6 mb-4">
<a href="#" class="hover:text-white transition-colors"><i class="fab fa-github"></i></a>
<a href="#" class="hover:text-white transition-colors"><i class="fab fa-twitter"></i></a>
<a href="#" class="hover:text-white transition-colors"><i class="fab fa-linkedin"></i></a>
</div>
<p class="mb-2">NameExplorer ‚Äî Cultural Identity Analysis Tool</p>
<p class="text-sm">Built with privacy in mind. No data is stored or transmitted.</p>
</div>
</footer>

<script>
// Configuration
const CONFIG = {
API: {
NATIONALIZE: 'https://api.nationalize.io',
REST_COUNTRIES: 'https://restcountries.com/v3.1/alpha/'
},
DISPLAY: {
MAX_COUNTRIES: 8,
MAX_VARIANTS: 12
},
GLOBE: {
ROTATION_SPEED: 0.1,
ENABLE_AUTO_ROTATE: true
}
};

// Country code to language mapping
const COUNTRY_LANGUAGES = {
"US":"en","GB":"en","FR":"fr","DE":"de","ES":"es","IT":"it","PT":"pt","RU":"ru","JP":"ja","CN":"zh","KR":"ko","IN":"hi","BR":"pt","CA":"en","AU":"en","MX":"es","NL":"nl","BE":"nl","SE":"sv","CH":"de","AT":"de","NO":"no","DK":"da","FI":"fi","IE":"en","PL":"pl","GR":"el","TR":"tr","IL":"he","SA":"ar","AE":"ar","AR":"es","CL":"es","CO":"es","PE":"es","ZA":"en","NG":"en","PH":"en","TH":"th","VN":"vi","ID":"id","PK":"ur","BD":"bn","LK":"si","EG":"ar","MA":"ar","RO":"ro","HU":"hu","CZ":"cs","SK":"sk","UA":"uk","BY":"be","RS":"sr","HR":"hr","SI":"sl","BG":"bg","EE":"et","LV":"lv","LT":"lt","IS":"is"
};

// Name variants database
const NAME_VARIANTS = {
"Laurent": ["Lorenzo", "Lawrence", "Lavrentiy", "Laurence", "Lorenz"],
"John": ["Juan", "Jean", "Johann", "Giovanni", "Sean", "Ian", "Ivan"],
"Maria": ["Marie", "Mary", "Mar√≠a", "Marya", "Mariya", "Mariam"],
"Michael": ["Miguel", "Michele", "Mikhail", "Mikael", "Micheal"],
"Anna": ["Anne", "Ana", "Ann", "Hannah", "Annette", "Annie"],
"David": ["D√°vid", "Dawid", "Daid", "Dawood", "Dafydd"],
"Sarah": ["Sara", "Zara", "Saira", "Saara", "Sarai"],
"James": ["Jacques", "Jacopo", "Seamus", "Hamish", "Jaime"],
"Elizabeth": ["Isabel", "Elisabet", "El≈ºbieta", "Yelizaveta", "Elisheva"],
"Mohammed": ["Muhammad", "Mehmet", "Mahmoud", "Ahmed", "Hamid"]
};

// DOM Elements
const elements = {
analyzeBtn: document.getElementById('analyzeBtn'),
nameInput: document.getElementById('nameInput'),
consentCheckbox: document.getElementById('consentCheckbox'),
results: document.getElementById('results'),
btnText: document.getElementById('btnText'),
btnLoading: document.getElementById('btnLoading'),
globeSection: document.getElementById('globeSection'),
regionSection: document.getElementById('regionSection'),
tabGlobe: document.getElementById('tabGlobe'),
tabRegion: document.getElementById('tabRegion'),
quickStats: document.getElementById('quickStats'),
topProbability: document.getElementById('topProbability'),
countriesCount: document.getElementById('countriesCount'),
countryDetails: document.getElementById('countryDetails'),
regionalStats: document.getElementById('regionalStats'),
globeViz: document.getElementById('globeViz')
};

// Application State
let state = {
currentChart: null,
isAnalyzing: false,
currentName: '',
countryData: null,
globe: null,
currentTab: 'globe'
};

/**
* Initialize the application
*/
function init() {
setupEventListeners();
initializeGlobe();
console.log('üåç NameExplorer initialized');
}

/**
* Set up event listeners
*/
function setupEventListeners() {
elements.analyzeBtn.addEventListener('click', handleAnalysis);
elements.nameInput.addEventListener('input', handleInputChange);
elements.nameInput.addEventListener('keydown', (e) => {
if (e.key === 'Enter' && !state.isAnalyzing) {
handleAnalysis();
}
});
elements.consentCheckbox.addEventListener('change', handleConsentChange);

// Tab switching
elements.tabGlobe.addEventListener('click', () => switchTab('globe'));
elements.tabRegion.addEventListener('click', () => switchTab('region'));

// Add placeholder rotation
const placeholders = [
"Enter a name to explore...",
"Try 'Maria', 'Zhang', or 'Mohammed'...",
"Discover your name's colorful journey...",
"Examples: Laurent, Anna, James..."
];
let placeholderIndex = 0;
setInterval(() => {
elements.nameInput.placeholder = placeholders[placeholderIndex];
placeholderIndex = (placeholderIndex + 1) % placeholders.length;
}, 3000);
}

/**
* Switch between tabs
*/
function switchTab(tab) {
state.currentTab = tab;

// Update tab buttons
elements.tabGlobe.classList.toggle('tab-active', tab === 'globe');
elements.tabGlobe.classList.toggle('text-gray-600', tab !== 'globe');
elements.tabRegion.classList.toggle('tab-active', tab === 'region');
elements.tabRegion.classList.toggle('text-gray-600', tab !== 'region');

// Show/hide sections
elements.globeSection.classList.toggle('hidden', tab !== 'globe');
elements.regionSection.classList.toggle('hidden', tab !== 'region');

// If switching to region tab and we have data, update region view
if (tab === 'region' && state.countryData) {
updateRegionView();
}
}

/**
* Handle input changes
*/
function handleInputChange() {
const hasText = elements.nameInput.value.trim().length > 0;
const hasConsent = elements.consentCheckbox.checked;
elements.analyzeBtn.disabled = !(hasText && hasConsent) || state.isAnalyzing;
}

/**
* Handle consent checkbox changes
*/
function handleConsentChange() {
handleInputChange();
}

/**
* Handle name analysis
*/
function handleAnalysis() {
const name = elements.nameInput.value.trim();
if (name && !state.isAnalyzing) {
analyzeName(name);
}
}

/**
* Initialize the globe visualization
*/
function initializeGlobe() {
state.globe = Globe()(elements.globeViz)
.globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
.bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
.backgroundColor('rgba(0,0,0,0)')
.showAtmosphere(true)
.atmosphereColor('rgba(100, 149, 237, 0.3)')
.atmosphereAltitude(0.2)
.hexBinPointWeight('weight')
.hexBinResolution(4)
.hexBinMargin(0.3)
.hexBinMerge(true)
.hexAltitude(0.01)
.hexTopColor(d => `rgba(139, 95, 191, ${Math.max(0.1, d.weight / 100)})`)
.hexSideColor(() => 'rgba(139, 95, 191, 0.3)')
.hexLabel(d => `
<div class="bg-black text-white p-2 rounded-lg">
<strong>${d.country}</strong><br/>
Probability: ${d.weight}%
</div>
`)
.onHexClick(d => {
// When a hex is clicked, switch to region view and show details
switchTab('region');
showCountryDetails(d.country, d.weight);
});

// Auto-rotate the globe
if (CONFIG.GLOBE.ENABLE_AUTO_ROTATE) {
let angle = 0;
const animate = () => {
angle += CONFIG.GLOBE.ROTATION_SPEED * 0.01;
state.globe.rotation({ y: angle });
requestAnimationFrame(animate);
};
animate();
}
}

/**
* Update globe with new data
*/
function updateGlobeData(countryData) {
if (!state.globe) return;

const globeData = countryData.map(country => ({
lat: 0, // These would normally be actual coordinates
lng: 0,
country: country.country_id,
weight: (country.probability * 100).toFixed(1)
}));

state.globe.hexBinPointsData(globeData);
}

/**
* Show country details in region view
*/
async function showCountryDetails(countryCode, probability) {
try {
const response = await fetch(`${CONFIG.REST_COUNTRIES}${countryCode}`);
const countryInfo = await response.json();
const country = countryInfo[0];

elements.countryDetails.innerHTML = `
<div class="flex items-center justify-center mb-4">
<img src="${country.flags.png}" alt="${country.name.common} flag" class="country-flag mr-4">
<h4 class="text-2xl font-bold">${country.name.common}</h4>
</div>
<div class="text-lg font-semibold mb-2">${probability}% Match</div>
<div class="space-y-2 text-left">
<div><strong>Region:</strong> ${country.region}</div>
<div><strong>Subregion:</strong> ${country.subregion || 'N/A'}</div>
<div><strong>Language:</strong> ${Object.values(country.languages || {}).join(', ') || 'N/A'}</div>
<div><strong>Population:</strong> ${country.population?.toLocaleString() || 'N/A'}</div>
<div><strong>Capital:</strong> ${country.capital?.[0] || 'N/A'}</div>
</div>
`;
} catch (error) {
console.error('Error fetching country details:', error);
elements.countryDetails.innerHTML = `
<div class="text-center">
<i class="fas fa-exclamation-triangle mr-2"></i>
Could not load country details
</div>
`;
}
}

/**
* Update region view with statistics
*/
function updateRegionView() {
if (!state.countryData) return;

// Group by region (simplified)
const regions = {
'Europe': ['GB', 'FR', 'DE', 'IT', 'ES', 'NL', 'BE', 'SE', 'CH', 'AT', 'NO', 'DK', 'FI', 'IE', 'PL', 'GR', 'RO', 'HU', 'CZ', 'SK', 'UA', 'BY', 'RS', 'HR', 'SI', 'BG', 'EE', 'LV', 'LT', 'IS'],
'Asia': ['RU', 'JP', 'CN', 'KR', 'IN', 'TH', 'VN', 'ID', 'PK', 'BD', 'LK', 'TR', 'IL', 'SA', 'AE'],
'Americas': ['US', 'CA', 'MX', 'BR', 'AR', 'CL', 'CO', 'PE'],
'Africa': ['ZA', 'NG', 'EG', 'MA'],
'Oceania': ['AU']
};

let regionStats = '';
for (const [region, countries] of Object.entries(regions)) {
const regionProbability = state.countryData
.filter(c => countries.includes(c.country_id))
.reduce((sum, c) => sum + c.probability, 0);

if (regionProbability > 0) {
regionStats += `
<div class="flex justify-between items-center">
<span>${region}</span>
<span class="font-bold">${(regionProbability * 100).toFixed(1)}%</span>
</div>
`;
}
}

elements.regionalStats.innerHTML = regionStats || '<div class="text-white/80">No regional data available</div>';
}

/**
* Soundex algorithm for phonetic matching
*/
function soundex(str) {
if (!str) return '';

const s = str.toUpperCase().split('');
const f = s.shift();
const codes = {
'B': 1, 'F': 1, 'P': 1, 'V': 1,
'C': 2, 'G': 2, 'J': 2, 'K': 2, 'Q': 2, 'S': 2, 'X': 2, 'Z': 2,
'D': 3, 'T': 3,
'L': 4,
'M': 5, 'N': 5,
'R': 6
};

let result = f;
let lastCode = codes[f] || 0;

s.forEach(char => {
const code = codes[char] || 0;
if (code !== 0 && code !== lastCode) {
result += code;
}
lastCode = code;
});

return (result + "000").slice(0, 4);
}

/**
* Generate name variants
*/
function generateVariants(name) {
const variants = new Set();

if (NAME_VARIANTS[name]) {
NAME_VARIANTS[name].forEach(variant => variants.add(variant));
}

const targetSound = soundex(name);
for (const [key, variantList] of Object.entries(NAME_VARIANTS)) {
if (key !== name && soundex(key) === targetSound) {
variantList.forEach(variant => variants.add(variant));
}
}

return Array.from(variants).filter(v =>
v.toLowerCase() !== name.toLowerCase()
).slice(0, CONFIG.DISPLAY.MAX_VARIANTS);
}

/**
* Text-to-speech function
*/
function speakName(name, lang) {
window.speechSynthesis?.cancel();

if ('speechSynthesis' in window) {
try {
const utterance = new SpeechSynthesisUtterance(name);
utterance.lang = lang;
utterance.rate = 0.9;
utterance.pitch = 1.0;

const voices = speechSynthesis.getVoices();
const voice = voices.find(v => v.lang.startsWith(lang)) || voices[0];
if (voice) {
utterance.voice = voice;
}

speechSynthesis.speak(utterance);
return true;
} catch (error) {
console.warn('Web Speech API failed:', error);
return false;
}
}
return false;
}

/**
* Create pronunciation chip
*/
function createPronunciationChip(text, lang, type = 'seed-chip') {
const safeText = text.replace(/'/g, "\\'").replace(/"/g, '&quot;');
return `
<button class="chip ${type}"
onclick="speakName('${safeText}', '${lang}')"
aria-label="Pronounce ${text} in ${lang}">
<i class="fas fa-volume-up mr-2"></i>${text}
</button>
`;
}

/**
* Show loading state
*/
function showLoading() {
state.isAnalyzing = true;
elements.btnText.classList.add('hidden');
elements.btnLoading.classList.remove('hidden');
elements.analyzeBtn.disabled = true;
}

/**
* Hide loading state
*/
function hideLoading() {
state.isAnalyzing = false;
elements.btnText.classList.remove('hidden');
elements.btnLoading.classList.add('hidden');
handleInputChange();
}

/**
* Clear previous results
*/
function clearResults() {
elements.results.innerHTML = '';
elements.quickStats.classList.add('hidden');
if (state.currentChart) {
state.currentChart.destroy();
state.currentChart = null;
}
}

/**
* Analyze a name
*/
async function analyzeName(name) {
if (!elements.consentCheckbox.checked) {
alert('Please confirm the privacy notice to continue.');
return;
}

clearResults();
showLoading();
state.currentName = name;

try {
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 10000);

const response = await fetch(
`${CONFIG.API.NATIONALIZE}/?name=${encodeURIComponent(name)}`,
{ signal: controller.signal }
);

clearTimeout(timeoutId);

if (!response.ok) {
throw new Error(`API responded with status: ${response.status}`);
}

const data = await response.json();
state.countryData = data.country;
renderResults(name, data);

} catch (error) {
console.error('Analysis error:', error);
showError(`Unable to analyze name. Please try again. ${error.message}`);
} finally {
hideLoading();
}
}

/**
* Render analysis results
*/
function renderResults(name, data) {
let html = `
<div class="fade-in">
<div class="flex items-center justify-between mb-6">
<h2 class="text-3xl font-bold text-gray-800">Analysis Results for <span class="gradient-text">"${name}"</span></h2>
<div class="flex space-x-2">
<button class="btn-secondary px-4 py-2 rounded-lg text-sm">
<i class="fas fa-download mr-2"></i>Export
</button>
<button class="btn-primary px-4 py-2 rounded-lg text-sm">
<i class="fas fa-share mr-2"></i>Share
</button>
</div>
</div>
`;

if (data.country && data.country.length > 0) {
const topCountry = data.country[0];
const topLang = COUNTRY_LANGUAGES[topCountry.country_id] || 'en';

// Update quick stats
elements.topProbability.textContent = `${(topCountry.probability * 100).toFixed(1)}%`;
elements.countriesCount.textContent = data.country.length;
elements.quickStats.classList.remove('hidden');

// Update globe
updateGlobeData(data.country);

// Update region view if active
if (state.currentTab === 'region') {
updateRegionView();
showCountryDetails(topCountry.country_id, (topCountry.probability * 100).toFixed(1));
}

// Auto-play pronunciation
setTimeout(() => speakName(name, topLang), 500);

html += `
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
<div class="bg-white/80 p-6 rounded-2xl">
<h3 class="text-xl font-bold mb-4 text-gray-800 section-title">Probability Distribution</h3>
<canvas id="probabilityChart" height="300"></canvas>
</div>
<div>
<h3 class="text-xl font-bold mb-4 text-gray-800 section-title">Hear Pronunciation</h3>
<p class="text-gray-600 mb-3">Click to hear the name pronounced in different languages:</p>
<div class="flex flex-wrap">
`;

data.country.slice(0, CONFIG.DISPLAY.MAX_COUNTRIES).forEach(country => {
const lang = COUNTRY_LANGUAGES[country.country_id] || 'en';
const probability = (country.probability * 100).toFixed(1);
html += createPronunciationChip(
`${name} (${probability}%)`,
lang,
'seed-chip'
);
});

html += `</div></div></div>`;

// Create probability chart
setTimeout(() => renderProbabilityChart(data), 100);
} else {
html += `
<div class="text-center py-8">
<div class="text-6xl mb-4">üîç</div>
<h3 class="text-xl font-semibold mb-2 text-gray-700">No Data Found</h3>
<p class="text-gray-600">
We couldn't find nationality data for "${name}".
This might be a very rare or unique name.
</p>
</div>
`;
}

// Add external resources
const nameLower = name.toLowerCase();
html += `
<div class="mb-8">
<h3 class="text-xl font-bold mb-4 text-gray-800 section-title">Learn More</h3>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<a href="https://www.behindthename.com/name/${encodeURIComponent(nameLower)}"
target="_blank"
class="color-card-1 p-4 rounded-xl text-white hover:shadow-lg transition-all block text-center">
<div class="mb-2"><i class="fas fa-book-open text-2xl"></i></div>
<div class="font-semibold mb-1">BehindTheName</div>
<div class="text-sm text-white/80">Origin & Meaning</div>
</a>
<a href="https://forvo.com/word/${encodeURIComponent(nameLower)}/"
target="_blank"
class="color-card-2 p-4 rounded-xl text-white hover:shadow-lg transition-all block text-center">
<div class="mb-2"><i class="fas fa-microphone text-2xl"></i></div>
<div class="font-semibold mb-1">Forvo</div>
<div class="text-sm text-white/80">Native Pronunciations</div>
</a>
<a href="https://www.names.org/n/${encodeURIComponent(nameLower)}"
target="_blank"
class="color-card-3 p-4 rounded-xl text-white hover:shadow-lg transition-all block text-center">
<div class="mb-2"><i class="fas fa-users text-2xl"></i></div>
<div class="font-semibold mb-1">Names.org</div>
<div class="text-sm text-white/80">Popularity & Statistics</div>
</a>
</div>
</div>
`;

// Add name variants
const variants = generateVariants(name);
if (variants.length > 0) {
html += `
<div>
<h3 class="text-xl font-bold mb-4 text-gray-800 section-title">Related Names</h3>
<p class="text-gray-600 mb-3">Discover similar names across cultures:</p>
<div class="flex flex-wrap">
`;

const topLang = data.country && data.country.length > 0
? COUNTRY_LANGUAGES[data.country[0].country_id] || 'en'
: 'en';

variants.forEach(variant => {
html += createPronunciationChip(variant, topLang, 'dynamic-chip');
});

html += `</div></div>`;
}

html += `</div>`;
elements.results.innerHTML = html;
}

/**
* Render probability chart
*/
function renderProbabilityChart(data) {
const ctx = document.getElementById('probabilityChart');
if (!ctx) return;

const countries = data.country.slice(0, CONFIG.DISPLAY.MAX_COUNTRIES);
const labels = countries.map(c => c.country_id);
const probabilities = countries.map(c => (c.probability * 100).toFixed(1));

state.currentChart = new Chart(ctx, {
type: 'doughnut',
data: {
labels,
datasets: [{
data: probabilities,
backgroundColor: [
'rgba(139, 95, 191, 0.8)',
'rgba(255, 107, 107, 0.8)',
'rgba(78, 205, 196, 0.8)',
'rgba(255, 209, 102, 0.8)',
'rgba(106, 17, 203, 0.8)',
'rgba(37, 117, 252, 0.8)',
'rgba(66, 230, 149, 0.8)',
'rgba(255, 210, 111, 0.8)'
],
borderColor: 'white',
borderWidth: 2,
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
position: 'right',
},
tooltip: {
callbacks: {
label: function(context) {
return ` ${context.label}: ${context.parsed}%`;
}
}
}
},
cutout: '60%',
}
});
}

/**
* Show error message
*/
function showError(message) {
elements.results.innerHTML = `
<div class="fade-in">
<div class="bg-red-50 border border-red-200 rounded-2xl p-6 text-center">
<div class="text-red-500 text-4xl mb-3">
<i class="fas fa-exclamation-triangle"></i>
</div>
<h3 class="text-lg font-semibold text-red-800 mb-2">Analysis Failed</h3>
<p class="text-red-700 mb-4">${message}</p>
<button onclick="analyzeName('${state.currentName}')"
class="btn-primary px-6 py-2 rounded-lg">
Try Again
</button>
</div>
</div>
`;
}

// Initialize the application
document.addEventListener('DOMContentLoaded', init);

// Make functions globally available
window.speakName = speakName;
window.analyzeName = analyzeName;
</script>
</body>
</html>
